name: 'deltapkg'

on:
  workflow_dispatch:
    inputs:
      manual_commit_id_from:
        description: enter commit id from
        required: true
      manual_commit_id_to:
        description: enter commit id to
        required: false
        default: HEAD
jobs:
  deltapkg:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
        with:
          fetch-depth: 0
          
      - name: Install salesforce
        run: |
          sudo apt update
          sudo apt install nodejs npm
          node --version
          wget https://developer.salesforce.com/media/salesforce-cli/sfdx-linux-amd64.tar.xz
          mkdir sfdx-cli
          tar xJf sfdx-linux-amd64.tar.xz -C sfdx-cli --strip-components 1
          ./sfdx-cli/install
          node --version
          echo 'y' | sfdx plugins:install sfpowerkit
          echo 'y' | sfdx plugins:install @dxatscale/sfpowerscripts
          sfdx sfpowerkit:project:diff --revisionfrom ${{github.event.inputs.manual_commit_id_from}} --revisionto ${{github.event.inputs.manual_commit_id_to}} --output OutputFolder
          tree OutputFolder
      - name: deltapkg these
        run: |
          sfdx sfpowerkit:project:diff --revisionfrom ${{github.event.inputs.manual_commit_id_from}} --revisionto ${{github.event.inputs.manual_commit_id_to}} --output OutputFolder
          tree OutputFolder
